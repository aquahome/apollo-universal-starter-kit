From ad49839a82b8b328b8720eb7e42f723f12da4d99 Mon Sep 17 00:00:00 2001
From: Aleksey Zadorozhniy <zadorozhniyal@gmail.com>
Date: Mon, 19 Mar 2018 11:48:47 +0200
Subject: [PATCH 3/4] Add the ability to customize page layout

---
 .../components/web/ui-bootstrap/components/index.js       |  1 -
 packages/client/src/modules/contact/index.web.jsx         |  7 +++----
 .../ui-bootstrap => defaultRouter}/components/NavBar.jsx  |  4 ++--
 .../components/PageLayout.jsx                             |  2 +-
 packages/client/src/modules/defaultRouter/index.web.jsx   | 14 ++++++++++----
 packages/client/src/modules/user/index.web.jsx            | 15 +++++++--------
 packages/client/src/testHelpers/Renderer.js               |  2 +-
 .../templates/module/client/components/ModuleView.web.jsx |  5 ++---
 8 files changed, 26 insertions(+), 24 deletions(-)
 rename packages/client/src/modules/{common/components/web/ui-bootstrap => defaultRouter}/components/NavBar.jsx (86%)
 rename packages/client/src/modules/{common/components/web/ui-bootstrap => defaultRouter}/components/PageLayout.jsx (93%)

diff --git a/packages/client/src/modules/common/components/web/ui-bootstrap/components/index.js b/packages/client/src/modules/common/components/web/ui-bootstrap/components/index.js
index 272e7bcf..c581af56 100644
--- a/packages/client/src/modules/common/components/web/ui-bootstrap/components/index.js
+++ b/packages/client/src/modules/common/components/web/ui-bootstrap/components/index.js
@@ -1,5 +1,4 @@
 // eslint-disable-next-line import/prefer-default-export
-export { default as PageLayout } from './PageLayout';
 export { default as Button } from './Button';
 export { default as MenuItem } from './MenuItem';
 export { default as Form } from './Form';
diff --git a/packages/client/src/modules/contact/index.web.jsx b/packages/client/src/modules/contact/index.web.jsx
index 97636639..123231d2 100644
--- a/packages/client/src/modules/contact/index.web.jsx
+++ b/packages/client/src/modules/contact/index.web.jsx
@@ -1,9 +1,9 @@
 import React from 'react';
 import { Route, NavLink } from 'react-router-dom';
-import { MenuItem } from '../../modules/common/components/web';
-import Contact from './containers/Contact';
 
+import Contact from './containers/Contact';
 import Feature from '../connector';
+import { MenuItem } from '../../modules/common/components/web';
 
 export default new Feature({
   route: <Route exact path="/contact" component={Contact} />,
@@ -13,6 +13,5 @@ export default new Feature({
         Contact Us
       </NavLink>
     </MenuItem>
-  ),
-  container: { path: ['contact'], wrapper: 'ContactWrapper' }
+  )
 });
diff --git a/packages/client/src/modules/common/components/web/ui-bootstrap/components/NavBar.jsx b/packages/client/src/modules/defaultRouter/components/NavBar.jsx
similarity index 86%
rename from packages/client/src/modules/common/components/web/ui-bootstrap/components/NavBar.jsx
rename to packages/client/src/modules/defaultRouter/components/NavBar.jsx
index e6498f03..f3af3b15 100644
--- a/packages/client/src/modules/common/components/web/ui-bootstrap/components/NavBar.jsx
+++ b/packages/client/src/modules/defaultRouter/components/NavBar.jsx
@@ -2,8 +2,8 @@ import React from 'react';
 import { NavLink } from 'react-router-dom';
 import { Container, Navbar, Nav, NavItem } from 'reactstrap';
 
-import modules from '../../../../../../modules';
-import settings from '../../../../../../../../../settings';
+import modules from '../../../modules';
+import settings from '../../../../../../settings';
 
 const NavBar = () => (
   <Navbar color="faded" light>
diff --git a/packages/client/src/modules/common/components/web/ui-bootstrap/components/PageLayout.jsx b/packages/client/src/modules/defaultRouter/components/PageLayout.jsx
similarity index 93%
rename from packages/client/src/modules/common/components/web/ui-bootstrap/components/PageLayout.jsx
rename to packages/client/src/modules/defaultRouter/components/PageLayout.jsx
index c2fb89f6..d9ff42ed 100644
--- a/packages/client/src/modules/common/components/web/ui-bootstrap/components/PageLayout.jsx
+++ b/packages/client/src/modules/defaultRouter/components/PageLayout.jsx
@@ -4,7 +4,7 @@ import styled from 'styled-components';
 import { Container } from 'reactstrap';
 
 import NavBar from './NavBar';
-import settings from '../../../../../../../../../settings';
+import settings from '../../../../../../settings';
 
 const footerHeight = '40px';
 
diff --git a/packages/client/src/modules/defaultRouter/index.web.jsx b/packages/client/src/modules/defaultRouter/index.web.jsx
index a4398961..9eca9468 100644
--- a/packages/client/src/modules/defaultRouter/index.web.jsx
+++ b/packages/client/src/modules/defaultRouter/index.web.jsx
@@ -3,11 +3,17 @@ import PropTypes from 'prop-types';
 import { Switch, withRouter } from 'react-router-dom';
 
 import modules from '../';
-import { PageLayout } from '../common/components/web';
+import PageLayout from './components/PageLayout';
 import Feature from '../connector';
 
-const Wrapper = ({ children }) => {
-  return <PageLayout>{children}</PageLayout>;
+const Wrapper = ({ location: { pathname }, children }) => {
+  let wrapper = <PageLayout>{children}</PageLayout>;
+  modules.containers.forEach(cont => {
+    if (cont.path.includes(pathname)) {
+      wrapper = React.createElement(cont.wrapper, cont.props, children);
+    }
+  });
+  return wrapper;
 };
 
 const routerFactory = () => {
@@ -25,6 +31,6 @@ export default new Feature({
 });
 
 Wrapper.propTypes = {
-  location: PropTypes.string,
+  location: PropTypes.object,
   children: PropTypes.object
 };
diff --git a/packages/client/src/modules/user/index.web.jsx b/packages/client/src/modules/user/index.web.jsx
index ca8e9d4c..45494361 100644
--- a/packages/client/src/modules/user/index.web.jsx
+++ b/packages/client/src/modules/user/index.web.jsx
@@ -1,19 +1,18 @@
 import React from 'react';
 import { CookiesProvider } from 'react-cookie';
 import { NavLink } from 'react-router-dom';
-import { MenuItem } from '../../modules/common/components/web';
+
+import Feature from '../connector';
+import ForgotPassword from './containers/ForgotPassword';
+import Login from './containers/Login';
 import Profile from './containers/Profile';
-import Users from './components/Users';
-import UserEdit from './containers/UserEdit';
 import Register from './containers/Register';
-import Login from './containers/Login';
-import ForgotPassword from './containers/ForgotPassword';
 import ResetPassword from './containers/ResetPassword';
 import resolvers from './resolvers';
-
+import UserEdit from './containers/UserEdit';
+import Users from './components/Users';
 import { AuthRoute, AuthLoggedInRoute, AuthNav, AuthLogin, AuthProfile } from './containers/Auth';
-
-import Feature from '../connector';
+import { MenuItem } from '../../modules/common/components/web';
 
 function tokenMiddleware(req, options, next) {
   options.headers['x-token'] = window.localStorage.getItem('token');
diff --git a/packages/client/src/testHelpers/Renderer.js b/packages/client/src/testHelpers/Renderer.js
index c8fcde60..5bdd61c5 100644
--- a/packages/client/src/testHelpers/Renderer.js
+++ b/packages/client/src/testHelpers/Renderer.js
@@ -28,7 +28,7 @@ const ReactEnzymeAdapter = require('enzyme-adapter-react-16');
 const { ApolloProvider } = require('react-apollo');
 const Enzyme = require('enzyme');
 const clientModules = require('../modules').default;
-const { PageLayout } = require('../modules/common/components/web');
+const PageLayout = require('../modules/defaultRouter/components/PageLayout').default;
 
 const mount = Enzyme.mount;
 
diff --git a/tools/templates/module/client/components/ModuleView.web.jsx b/tools/templates/module/client/components/ModuleView.web.jsx
index 49bca7ba..bfaa8cd8 100644
--- a/tools/templates/module/client/components/ModuleView.web.jsx
+++ b/tools/templates/module/client/components/ModuleView.web.jsx
@@ -1,6 +1,5 @@
 import React from 'react';
 import Helmet from 'react-helmet';
-import { PageLayout } from '../../common/components/web';
 
 const renderMetaData = () => (
   <Helmet
@@ -16,12 +15,12 @@ const renderMetaData = () => (
 
 const $Module$View = () => {
   return (
-    <PageLayout>
+    <section>
       {renderMetaData()}
       <div className="text-center mt-4 mb-4">
         <p>Hello $Module$!</p>
       </div>
-    </PageLayout>
+    </section>
   );
 };
 
-- 
2.16.2.windows.1

